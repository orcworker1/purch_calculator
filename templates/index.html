{% extends "base.html" %}
{% load django_bootstrap5 %}

{% block content %}

<style>
  .section-title {
    color: #0f5132;
    font-weight: 600;
  }

  .table caption {
    caption-side: top;
    font-weight: 600;
    color: #0f5132;
  }

  .card-action {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
  }
</style>

<section class="container mt-4">
  <h1 class="text-center mb-4 section-title">
    Финансовая модель для закупки масличных
  </h1>

  <div class="row g-4">
    <div class="col-md-6">
      <div class="card shadow-sm h-100 border-success">
        <div class="card-header bg-success bg-opacity-25 text-center fw-semibold">
          Подсолнечник
        </div>
        <div class="card-body p-0">
          {% if sunflower %}
          <table class="table table-striped table-bordered mb-0">
            <thead class="table-light">
              <tr class="text-center">
                <th>Показатель</th>
                <th>Базовое значение, %</th>
                <th>Коэффициент съёма, руб/1%</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row" class="text-start">Масличность</th>
                <td>{{ sunflower.oil_content_base }}</td>
                <td>{{ sunflower.oil_content_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Сорность</th>
                <td>{{ sunflower.weed_impurity_base }}</td>
                <td>{{ sunflower.weed_impurity_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Протеин</th>
                <td>{{ sunflower.protein_base }}</td>
                <td>{{ sunflower.protein_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Масличная примесь</th>
                <td>{{ sunflower.oil_impurity_base }}</td>
                <td>{{ sunflower.oil_impurity_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">КЧМ</th>
                <td>{{ sunflower.KCHM_base }}</td>
                <td>{{ sunflower.KCHM_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Влажность</th>
                <td>{{ sunflower.moisture_base }}</td>
                <td>{{ sunflower.moisture_removal }}</td>
              </tr>
            </tbody>
          </table>
          {% else %}
          <div class="p-4 text-center text-muted">
            Данные по подсолнечнику пока не заданы.
          </div>
          {% endif %}
        </div>
        <div class="card-footer bg-white card-action">
          <span class="text-muted small">Настройки подсолнечника</span>
          <a href="{% url 'update_sunflower' %}" class="btn btn-success btn-sm">Изменить</a>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm h-100 border-warning">
        <div class="card-header bg-warning bg-opacity-25 text-center fw-semibold">
          Рапс
        </div>
        <div class="card-body p-0">
          {% if raps %}
          <table class="table table-striped table-bordered mb-0">
            <thead class="table-light">
              <tr class="text-center">
                <th>Показатель</th>
                <th>Базовое значение, %</th>
                <th>Коэффициент съёма, руб/1%</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row" class="text-start">Масличность</th>
                <td>{{ raps.oil_content_base }}</td>
                <td>{{ raps.oil_content_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Сорность</th>
                <td>{{ raps.weed_impurity_base }}</td>
                <td>{{ raps.weed_impurity_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Протеин</th>
                <td>{{ raps.protein_base }}</td>
                <td>{{ raps.protein_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Масличная примесь</th>
                <td>{{ raps.oil_impurity_base }}</td>
                <td>{{ raps.oil_impurity_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">КЧМ</th>
                <td>{{ raps.KCHM_base }}</td>
                <td>{{ raps.KCHM_removal }}</td>
              </tr>
              <tr>
                <th scope="row" class="text-start">Влажность</th>
                <td>{{ raps.moisture_base }}</td>
                <td>{{ raps.moisture_removal }}</td>
              </tr>
            </tbody>
          </table>
          {% else %}
          <div class="p-4 text-center text-muted">
            Данные по рапсу пока не заданы.
          </div>
          {% endif %}
        </div>
        <div class="card-footer bg-white card-action">
          <span class="text-muted small">Настройки рапса</span>
          <a href="{% url 'update_raps' %}" class="btn btn-warning btn-sm text-white">Изменить</a>
        </div>
      </div>
    </div>
  </div>
</section>

{% if batch %}
<section class="container mt-5 mb-5">
  <div class="card shadow-sm border-success">
    <div class="card-header bg-success bg-opacity-75 text-white text-center fw-semibold">
      Входные данные по текущей партии
    </div>
    <div class="card-body">
      <div class="row g-4">
        <div class="col-lg-4">
          <div class="card h-100 border-0">
            <div class="card-header bg-light fw-semibold text-center">
              Основные параметры
            </div>
            <div class="card-body p-0">
              <table class="table table-bordered mb-0">
                <tbody>
                  <tr>
                    <th scope="row" class="text-start">Закупочная цена, руб/кг</th>
                    <td class="text-center">{{ batch.purchase_price }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Масса партии, т</th>
                    <td class="text-center">{{ batch.weight_actual }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Культура партии</th>
                    <td class="text-center">{{ batch.get_culture_display }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Начало приемки</th>
                    <td class="text-center">{{ batch.receipt_start_date|default:"—" }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Окончание приемки</th>
                    <td class="text-center">{{ batch.receipt_end_date|default:"—" }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Отсрочка, дней</th>
                    <td class="text-center">{{ batch.delay_days }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card h-100 border-0">
            <div class="card-header bg-light fw-semibold text-center">
              Условия закупки
            </div>
            <div class="card-body p-0">
              <table class="table table-bordered mb-0">
                <tbody>
                  <tr>
                    <th scope="row" class="text-start">Вид закупки</th>
                    <td class="text-center">{{ batch.get_purchase_type_display }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Тип контракта</th>
                    <td class="text-center">{{ batch.get_contract_type_display }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Соглашение</th>
                    <td class="text-center">{{ batch.get_agreement_type_display }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Целевой завод</th>
                    <td class="text-center">{{ batch.get_target_factory_display }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Тип ТС</th>
                    <td class="text-center">{{ batch.get_transport_type_display }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Тип партнера</th>
                    <td class="text-center">{{ batch.get_partner_type_display }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card h-100 border-0">
            <div class="card-header bg-light fw-semibold text-center">
              Показатели качества, %
            </div>
            <div class="card-body p-0">
              <table class="table table-bordered mb-0">
                <tbody>
                  <tr>
                    <th scope="row" class="text-start">Масличность</th>
                    <td class="text-center">{{ batch.oil_content_actual }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Сорность</th>
                    <td class="text-center">{{ batch.weed_impurity_actual }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Протеин</th>
                    <td class="text-center">{{ batch.protein_actual }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Масличная примесь</th>
                    <td class="text-center">{{ batch.oil_impurity_actual }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">КЧМ</th>
                    <td class="text-center">{{ batch.KCHM_actual }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Влажность</th>
                    <td class="text-center">{{ batch.moisture_actual }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer bg-white text-center">
      <a href="{% url 'update_by_party' %}" class="btn btn-success px-4">Изменить входные данные</a>
    </div>
  </div>
</section>
{% endif %}
{% if tariffs %}
<section class="container mt-5 mb-5">
  <div class="card shadow-sm border-secondary">
    <div class="card-header bg-secondary bg-opacity-75 text-white text-center fw-semibold">
      Тарифы ТРАМПА
    </div>
    <div class="card-body">
      <div class="row g-4 justify-content-center">
        <div class="col-lg-8">
          <div class="card h-100 border-0">
            <div class="card-body p-0">
              <table class="table table-bordered mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="text-start">Показатель</th>
                    <th class="text-center">Значение</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row" class="text-start">Расстояние, км</th>
                    <td class="text-center">{{ tariffs.distance }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Срок хранения, дней</th>
                    <td class="text-center">{{ tariffs.storage_days }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Стоимость приемки, р/тн</th>
                    <td class="text-center">{{ tariffs.acceptance_cost }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Стоимость хранения, р/тн/сут</th>
                    <td class="text-center">{{ tariffs.storage_cost }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Тариф, р/тн/км</th>
                    <td class="text-center">{{ tariffs.tariff }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Стоимость отгрузки, р/тн</th>
                    <td class="text-center">{{ tariffs.shipping_cost }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-start">Естественная убыль, %</th>
                    <td class="text-center">{{ tariffs.natural_loss_pct }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer bg-white text-center">
      <a href="{% url 'update_tariffs' %}" class="btn btn-secondary px-4">Изменить тарифы</a>
    </div>
  </div>
</section>
{% endif %}

{% endblock %}